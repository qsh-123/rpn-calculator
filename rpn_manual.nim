import nimib

# 初始化Nimib文档
nbInit
nbTitle = "RPN计算器使用说明书"
nbSubtitle = "C++ 逆波兰表示法计算器完整指南"
nbAuthor = "RPN计算器开发团队"
nbDate = "2025年09月"

# 一、安装和编译指南
nbH1("一、安装和编译指南")
nbP("本章节详细介绍RPN计算器的环境准备、编译步骤和运行方式。")

nbH2("1.1 环境准备")
nbP("运行RPN计算器需满足以下环境要求：")
nbUl:
  nbLi("操作系统：Windows 10+/Linux（Ubuntu 18.04+/CentOS 7+）/macOS 10.14+")
  nbLi("C++编译器：GCC 7.0+ / Clang 8.0+ / MSVC 2019+")
  nbLi("依赖库：C++标准库、数学库（libm，Linux/macOS需显式链接）")
  nbLi("Nim环境（仅用于生成本文档，非计算器运行必需）：Nim 1.6.0+ + Nimib 0.7.0+")

nbH2("1.2 编译步骤")
nbP("请按照以下步骤编译C++源代码：")
nbCodeBlock("bash", """
# 1. 进入项目目录（替换为你的实际项目路径）
cd ~/Desktop/rpn_calculator

# 2. Linux/macOS 编译命令
g++ rpn_calc.cpp -o rpn_calc -lm

# 3. Windows（MinGW）编译命令
g++ rpn_calc.cpp -o rpn_calc.exe -lm

# 4. Visual Studio 编译命令（开发者命令提示符）
cl rpn_calc.cpp /Fe:rpn_calc.exe
""")

nbH2("1.3 运行方式")
nbCodeBlock("bash", """
# Linux/macOS 运行
./rpn_calc

# Windows 运行（MinGW/命令提示符）
rpn_calc.exe

# Windows 运行（双击打开）
直接双击 rpn_calc.exe 文件即可
""")

# 二、基本使用示例
nbH1("二、基本使用示例")
nbP("以下示例覆盖常见的计算场景，帮助快速上手RPN计算器。")

nbH2("2.1 简单四则运算")
nbP("示例1：计算 1 + 2 + 3 + (7 × 7)（常规四则运算组合）")
nbCodeBlock("bash", """
> 1 2 + 3 + 7 7 * +
计算结果：55
""")

nbP("示例2：计算 (10 - 4) × (3 + 2)（带括号的四则运算）")
nbCodeBlock("bash", """
> 10 4 - 3 2 + *
计算结果：30
""")

nbP("示例3：计算 100 ÷ (20 - 15)（除法与减法组合）")
nbCodeBlock("bash", """
> 100 20 15 - /
计算结果：20
""")

nbH2("2.2 高级功能使用")
nbP("示例4：计算 2^5（2的5次方，幂运算）")
nbCodeBlock("bash", """
> 2 5 ^
计算结果：32
""")

nbP("示例5：计算 √25（25的平方根）")
nbCodeBlock("bash", """
> 25 s
计算结果：5
""")

nbP("示例6：计算第10项斐波那契数（斐波那契数列功能）")
nbCodeBlock("bash", """
> 10 f
斐波那契计算结果：55
""")

# 三、所有支持的操作说明
nbH1("三、支持的操作说明")
nbP("RPN计算器支持算术操作符和内置命令，详细说明如下。")

nbH2("3.1 算术操作符")
nbTable:
  nbTableRow(["操作符", "功能描述", "操作数数量", "使用示例", "输出结果"])
  nbTableRow(["+", "加法运算（前数 + 后数）", "2个", "5 5 +", "10"])
  nbTableRow(["-", "减法运算（前数 - 后数）", "2个", "10 4 -", "6"])
  nbTableRow(["*", "乘法运算（前数 × 后数）", "2个", "6 5 *", "30"])
  nbTableRow(["/", "除法运算（前数 ÷ 后数）", "2个", "10 2 /", "5"])
  nbTableRow(["^", "幂运算（前数的后数次方）", "2个", "2 5 ^", "32"])
  nbTableRow(["s", "平方根运算（仅对栈顶元素生效）", "1个", "25 s", "5"])

nbH2("3.2 内置命令")
nbTable:
  nbTableRow(["命令", "功能描述", "使用示例", "执行结果"])
  nbTableRow(["clear", "清空当前数字栈，重置栈状态", "> clear", "提示：栈已成功清空"])
  nbTableRow(["stack", "显示当前栈内所有元素（从栈底到栈顶）", "> stack", "当前栈内容（从栈底到栈顶）：5 10"])
  nbTableRow(["f", "计算斐波那契数列第n项（n从栈中弹出）", "> 10 f", "斐波那契计算结果：55"])
  nbTableRow(["q/Q", "退出计算器程序", "> q", "计算器已退出，感谢使用！"])

# 四、错误代码和异常说明
nbH1("四、错误代码和异常说明")
nbP("计算器会捕获所有常见异常，并输出明确的错误信息，便于排查问题。")

nbTable:
  nbTableRow(["错误类型", "错误提示信息", "产生原因", "解决方案"])
  nbTableRow(["栈空错误", "错误：栈为空，无法弹出数字", "执行运算时栈中数字数量不足（如仅输入1个数字就执行+运算）", "确保输入足够的数字后再执行运算"])
  nbTableRow(["除零错误", "错误：除数不能为0", "除法运算中右操作数为0（如 10 0 /）", "修改除数为非零数值"])
  nbTableRow(["表达式格式错误", "错误：表达式格式无效，栈中剩余N个数字", "输入的RPN表达式不合法（数字和操作符数量不匹配）", "检查表达式格式，确保操作符与数字对应"])
  nbTableRow(["操作符错误", "错误：不支持的操作符/多字符操作符", "输入了非支持的操作符（如 #）或多字符操作符（如 ++）", "使用支持的单字符操作符"])
  nbTableRow(["数值错误", "错误：负数无法计算平方根/斐波那契项数不能为负数", "平方根传入负数（如 -25 s）或斐波那契传入负项数（如 -5 f）", "平方根传入非负数，斐波那契传入非负整数"])

# 五、完整示例输入输出
nbH1("五、完整示例输入输出")
nbP("以下是一次完整的交互式操作流程，展示计算器的全部核心功能。")

nbCodeBlock("bash", """
==================== C++ RPN 计算器 ====================
使用说明：
1. 输入逆波兰表达式（空格分隔数字和操作符，例：5 5 +）
2. 支持算术操作符：+（加）、-（减）、*（乘）、/（除）
3. 支持高级操作符：^（幂运算）、s（平方根）
4. 内置命令：clear（清空栈）、stack（显示栈）、f（斐波那契）、q（退出）
========================================================
请输入表达式或命令：
> 1 2 +
计算结果：3
> 3 4 *
计算结果：12
> 12 6 /
计算结果：2
> 2 3 ^
计算结果：8
> 8 2 +
计算结果：10
> 100 s
计算结果：10
> 10 f
斐波那契计算结果：55
> stack
当前栈内容（从栈底到栈顶）：55 
> clear
提示：栈已成功清空
> stack
当前栈内容（从栈底到栈顶）：空
> q
计算器已退出，感谢使用！
""")

# 六、高级功能扩展与注意事项
nbH1("六、高级功能扩展与注意事项")

nbH2("6.1 高级功能说明")
nbUl:
  nbLi("幂运算：支持浮点数幂运算（如 2 0.5 ^ 等价于√2，结果约为1.4142）")
  nbLi("平方根运算：仅对栈顶元素生效，不影响其他栈内元素")
  nbLi("斐波那契数列：遵循 F(0)=0、F(1)=1、F(n)=F(n-1)+F(n-2) 的定义")
  nbLi("栈状态可视化：通过 stack 命令可实时查看栈内数据，便于调试复杂表达式")

nbH2("6.2 使用注意事项")
nbUl:
  nbLi("逆波兰表达式规则：操作符跟在操作数之后，且需用空格分隔所有元素")
  nbLi("操作数顺序：减法和除法是有序运算，先弹出的是右操作数（如 a b - 等价于 a - b）")
  nbLi("浮点数支持：输入带小数点的数字（如 3.14）即可进行浮点数计算")
  nbLi("异常处理：出现错误时，计算器会自动清空栈，不影响后续操作")

# 生成HTML文档
nbRender

